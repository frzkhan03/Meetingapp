{% extends 'base.html' %}

{% block title %}New Meeting - PyTalk{% endblock %}

{% block extra_css %}
<style>
    .meeting-form-container {
        max-width: 720px;
        margin: 0 auto;
    }

    /* Glass form card */
    .glass-form-card {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        padding: 2rem;
        transition: all 0.3s ease;
    }

    .glass-form-card:hover {
        border-color: var(--border-light);
    }

    .meeting-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .meeting-title-input {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 1.5rem;
        font-weight: 600;
        border: none;
        background: transparent;
        color: var(--text-primary);
        width: 100%;
        padding: 0.5rem 0;
    }

    .meeting-title-input:focus {
        outline: none;
        border-bottom: 2px solid var(--accent-primary);
    }

    .meeting-title-input::placeholder {
        color: var(--text-muted);
    }

    .form-section {
        margin-bottom: 1.5rem;
    }

    .form-section-title {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 0.75rem;
    }

    .form-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .form-row:last-child {
        border-bottom: none;
    }

    .form-row-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius-sm);
    }

    .form-row-content {
        flex: 1;
        min-width: 0;
    }

    .form-row-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.25rem;
    }

    .datetime-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .datetime-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .datetime-separator {
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .time-inputs {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-control-sm-custom {
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
        min-width: 120px;
    }

    .all-day-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .all-day-toggle:hover {
        background: var(--glass-bg-hover);
        border-color: var(--border-light);
    }

    .all-day-toggle input {
        margin: 0;
    }

    .all-day-toggle label {
        font-size: 0.875rem;
        cursor: pointer;
        margin: 0;
        color: var(--text-secondary);
    }

    .recurrence-select {
        min-width: 160px;
    }

    .description-textarea {
        min-height: 120px;
        resize: vertical;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border-color);
    }

    .online-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.25rem 0.75rem;
        background: rgba(129, 140, 248, 0.1);
        color: var(--accent-primary);
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        border: 1px solid rgba(129, 140, 248, 0.2);
    }

    .online-badge svg {
        width: 14px;
        height: 14px;
    }

    /* Glass settings section */
    .settings-section {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-md);
        padding: 1rem;
        margin-top: 1rem;
    }

    .settings-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0;
    }

    .settings-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-primary);
        font-size: 0.9rem;
    }

    .settings-label small {
        color: var(--text-muted);
        font-size: 0.8rem;
    }

    .form-switch .form-check-input {
        width: 2.5rem;
        height: 1.25rem;
        cursor: pointer;
    }

    .form-check-input:checked {
        background-color: var(--accent-primary);
        border-color: var(--accent-primary);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 fade-in">
    <div class="meeting-form-container">
        <form method="post" id="meetingForm">
            {% csrf_token %}

            <!-- Glass Form Card -->
            <div class="glass-form-card">
                <!-- Meeting Title -->
                <div class="form-section">
                    <input type="text"
                           name="name"
                           class="meeting-title-input"
                           placeholder="Add a title"
                           value="{{ form.name.value|default:'' }}"
                           required>
                </div>

                <!-- Date & Time -->
                <div class="form-row">
                    <div class="form-row-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </div>
                    <div class="form-row-content">
                        <div class="datetime-row">
                            <div class="datetime-group">
                                <input type="date"
                                       name="start_date"
                                       class="form-control form-control-sm-custom"
                                       value="{{ form.start_date.value|date:'Y-m-d'|default:'' }}"
                                       required>
                            </div>
                            <div class="time-inputs" id="timeInputs">
                                <input type="time"
                                       name="start_time"
                                       class="form-control form-control-sm-custom"
                                       value="{{ form.start_time.value|time:'H:i'|default:'' }}"
                                       required>
                                <span class="datetime-separator">to</span>
                                <input type="time"
                                       name="end_time"
                                       class="form-control form-control-sm-custom"
                                       value="{{ form.end_time.value|time:'H:i'|default:'' }}"
                                       required>
                            </div>
                            <div class="all-day-toggle">
                                <input type="checkbox"
                                       name="is_all_day"
                                       id="is_all_day"
                                       class="form-check-input"
                                       {% if form.is_all_day.value %}checked{% endif %}>
                                <label for="is_all_day">All day</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Repeat -->
                <div class="form-row">
                    <div class="form-row-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="17 1 21 5 17 9"/>
                            <path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                            <polyline points="7 23 3 19 7 15"/>
                            <path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                        </svg>
                    </div>
                    <div class="form-row-content">
                        <select name="recurrence" class="form-select recurrence-select">
                            <option value="none" {% if form.recurrence.value == 'none' %}selected{% endif %}>Does not repeat</option>
                            <option value="daily" {% if form.recurrence.value == 'daily' %}selected{% endif %}>Daily</option>
                            <option value="weekly" {% if form.recurrence.value == 'weekly' %}selected{% endif %}>Weekly</option>
                            <option value="biweekly" {% if form.recurrence.value == 'biweekly' %}selected{% endif %}>Every 2 weeks</option>
                            <option value="monthly" {% if form.recurrence.value == 'monthly' %}selected{% endif %}>Monthly</option>
                        </select>
                    </div>
                </div>

                <!-- Location -->
                <div class="form-row">
                    <div class="form-row-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                    </div>
                    <div class="form-row-content">
                        <div class="d-flex align-items-center gap-2">
                            <span class="online-badge">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="23 7 16 12 23 17 23 7"/>
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                                </svg>
                                PyTalk Meeting
                            </span>
                            <input type="text"
                                   name="location"
                                   class="form-control form-control-sm-custom flex-grow-1"
                                   placeholder="Add physical location (optional)"
                                   value="{{ form.location.value|default:'' }}">
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="form-row">
                    <div class="form-row-icon" style="align-self: flex-start; margin-top: 0.5rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="17" y1="10" x2="3" y2="10"/>
                            <line x1="21" y1="6" x2="3" y2="6"/>
                            <line x1="21" y1="14" x2="3" y2="14"/>
                            <line x1="17" y1="18" x2="3" y2="18"/>
                        </svg>
                    </div>
                    <div class="form-row-content">
                        <textarea name="description"
                                  class="form-control description-textarea"
                                  placeholder="Add a description or agenda for this meeting...">{{ form.description.value|default:'' }}</textarea>
                    </div>
                </div>

                <!-- Meeting Settings -->
                <div class="settings-section">
                    <div class="form-section-title">Meeting Options</div>
                    <div class="settings-row">
                        <div class="settings-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            <div>
                                <span>Require approval to join</span>
                                <br><small>Participants wait in lobby until admitted</small>
                            </div>
                        </div>
                        <div class="form-check form-switch">
                            <input type="checkbox"
                                   name="require_approval"
                                   class="form-check-input"
                                   id="require_approval"
                                   {% if form.require_approval.value != False %}checked{% endif %}>
                        </div>
                    </div>
                </div>

                <!-- Organization Info -->
                <div class="form-row mt-3">
                    <div class="form-row-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </div>
                    <div class="form-row-content">
                        <div class="form-row-label">Organization</div>
                        <strong>{{ organization.name }}</strong>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <a href="{% url 'meetings_list' %}" class="btn btn-outline-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Schedule Meeting
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const allDayCheckbox = document.getElementById('is_all_day');
    const timeInputs = document.getElementById('timeInputs');

    function toggleTimeInputs() {
        if (allDayCheckbox.checked) {
            timeInputs.style.display = 'none';
        } else {
            timeInputs.style.display = 'flex';
        }
    }

    allDayCheckbox.addEventListener('change', toggleTimeInputs);
    toggleTimeInputs(); // Initial state
});
</script>
{% endblock %}
